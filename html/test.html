<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Annotation test</title>
        <style type="text/css" media="screen">
            #canvascontainer {
                height: 300px;
                left: 50%;
                margin: -150px 0 0 -300px;
                position: absolute;
                top: 50%;
                width: 600px;
            }
            #paper {
                height: 300px;
                left: 0;
                position: absolute;
                top: 0;
                width: 300px;
            }
            h2 {
                text-align: center;
            }
        </style>
        <script type="text/javascript" src="js/jquery.js" charset="utf-8"></script>
        <script type="text/javascript" src="js/paper.js"></script>
        <script type="text/javascript" charset="utf-8">

            var draw_mode = 0;
            var drawnpath;

            // Only executed our code once the DOM is ready.
            $(document).ready(function() {
                "use strict";
                // Get a reference to the canvas object
                var canvas = $('#paperc')[0];
                //var canvas = document.getElementById('paperc');

                // Create an empty project and a view for the canvas:
                paper.setup(canvas);
                // Create a Paper.js Path to draw a line into it:
                var path = new paper.Path();
                // Give the stroke a color
                path.strokeColor = 'black';
                var start = new paper.Point(100, 100);
                // Move to start and draw a line from there
                path.moveTo(start);
                // Note that the plus operator on Point objects does not work
                // in JavaScript. Instead, we need to call the add() function:
                path.lineTo(start.add([ 200, -50 ]));

                var textItem = new paper.PointText({
                    content: 'Click and drag to draw a line.',
                    point: new paper.Point(20, 30),
                    fillColor: 'black',
                });

                $('#paperc').mousedown(function(event){
                    // If we produced a drawnpath before, deselect it:
                    if (drawnpath) {
                        drawnpath.selected = false;
                    }

                    // Create a new drawnpath and set its stroke color to black:
                    drawnpath = new paper.Path({
                        segments: [new paper.Point(event.offsetX, event.offsetY)],
                        strokeColor: 'black',
                        // Select the drawnpath, so we can see its segment points:
                        fullySelected: true
                    });
                    drawnpath.active = true;
                    paper.view.draw();
                });

                // While the user drags the mouse, points are added to the drawnpath
                // at the position of the mouse:
                $('#paperc').mousemove(function (event) {
                    if (drawnpath && drawnpath.active) {
                        drawnpath.add(new paper.Point(event.offsetX, event.offsetY));

                        // Update the content of the text item to show how many
                        // segments it has:
                        textItem.content = 'Segment count: ' + drawnpath.segments.length;
                        paper.view.draw();
                    };
                });

                // When the mouse is released, we simplify the drawnpath:
                $('#paperc').mouseup(function (event) {
                    var segmentCount = drawnpath.segments.length;
                    drawnpath.active = false;

                    // When the mouse is released, simplify it:
                    drawnpath.simplify(10);

                    // Select the drawnpath, so we can see its segments:
                    drawnpath.fullySelected = true;

                    var newSegmentCount = drawnpath.segments.length;
                    var difference = segmentCount - newSegmentCount;
                    var percentage = 100 - Math.round(newSegmentCount / segmentCount * 100);
                    textItem.content = difference + ' of the ' + segmentCount + ' segments were removed. Saving ' + percentage + '%';
                    paper.view.draw();
                });


                // Draw the view now:
                paper.view.draw();

            });
        </script>
    </head>
    <body>
        <div id="canvascontainer">
            <div id="paper" style="border: 1px solid">
                <canvas id="paperc" resize></canvas>
            </div>
        </div>
    </body>
</html>

