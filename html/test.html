<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Annotation test</title>
        <link href="css/jquery-ui-1.10.0.custom.min.css" rel="stylesheet">
        <style type="text/css" media="screen">
            #canvascontainer {
                height: 300px;
                left: 50%;
                margin: -150px 0 0 -300px;
                position: fixed;
                top: 50%;
                width: 600px;
            }
            #annotations_overlay {
                height: 300px;
                left: 0;
                position: absolute;
                top: 0;
                width: 300px;
                border: 1px solid;
            }
            #annotated_image {
                position: absolute;
                top: 1px;
                left: 1px;
            }
            h2 {
                text-align: center;
            }
        </style>
        <script type="text/javascript" src="js/jquery.js" charset="utf-8"></script>
        <script type="text/javascript" src="js/paper.js"></script>
        <script src="js/jquery-ui-1.10.0.custom.min.js"></script>

        <script type="text/javascript" charset="utf-8">

            var draw_mode = 0;
            var drawnpath;

            // Only executed our code once the DOM is ready.
            $(document).ready(function() {
                "use strict";
                // Get a reference to the canvas object
                var canvas = $('#annotations_overlay')[0];
                //var canvas = document.getElementById('annotations_overlay');

                // Create an empty project and a view for the canvas:
                paper.setup(canvas);

                $('#annotations_overlay').mousedown(function(event){
                    // If we produced a drawnpath before, deselect it:
                    if (drawnpath) {
                        drawnpath.selected = false;
                    }

                    // Create a new drawnpath and set its stroke color to black:
                    drawnpath = new paper.Path({
                        segments: [new paper.Point(event.offsetX, event.offsetY)],
                        strokeColor: 'black',
                        // Select the drawnpath, so we can see its segment points:
                        fullySelected: true
                    });
                    drawnpath.active = true;
                    paper.view.draw();
                });

                // While the user drags the mouse, points are added to the drawnpath
                // at the position of the mouse:
                $('#annotations_overlay').mousemove(function (event) {
                    if (drawnpath && drawnpath.active) {
                        drawnpath.add(new paper.Point(event.offsetX, event.offsetY));
                        paper.view.draw();
                    };
                });

                // When the mouse is released, we simplify the drawnpath:
                $('#annotations_overlay').mouseup(function (event) {
                    var segmentCount = drawnpath.segments.length;
                    drawnpath.active = false;

                    // When the mouse is released, simplify it:
                    drawnpath.simplify(10);

                    // Select the drawnpath, so we can see its segments:
                    drawnpath.fullySelected = true;

                    var newSegmentCount = drawnpath.segments.length;
                    var difference = segmentCount - newSegmentCount;
                    var percentage = 100 - Math.round(newSegmentCount / segmentCount * 100);
                    paper.view.draw();
                });


                // Draw the view now:
                paper.view.draw();

                show_toolbox();
            });


function show_toolbox() {
    "use strict";

    var d = $("div#toolbox").dialog({
        close: function() {
        },
        open: function() {
            //remove focus from the default button
            $('.ui-dialog :button').blur();
        },
        resizable: false,
        width: "368px"
    });
//    $(d).dialog('widget')
//        .position({ my: 'right top', at: 'right top', of: $("div#counterbox") });
}


        </script>
    </head>
    <body>
        <div id="toolbox">
            <div>a</div>
        </div>
        <div id="canvascontainer">
            <img id="annotated_image" src="ducks.png"/>
            <canvas id="annotations_overlay"></canvas>
        </div>
    </body>
</html>

